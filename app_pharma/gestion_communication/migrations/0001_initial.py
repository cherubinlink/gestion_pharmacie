# Generated by Django 6.0 on 2026-01-10 15:40

import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('gestion_compte', '0002_profilutilisateur'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Channel',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('channel_type', models.CharField(choices=[('urgent', 'Urgent'), ('stock', 'Stock'), ('security', 'Sécurité'), ('news', 'Nouveautés'), ('general', 'Général'), ('custom', 'Personnalisé')], max_length=20, verbose_name='Type de canal')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('icon', models.CharField(blank=True, help_text="Nom de l'icône ou emoji", max_length=50, verbose_name='Icône')),
                ('color', models.CharField(default='#3498db', help_text='Couleur hexadécimale', max_length=7, verbose_name='Couleur')),
                ('is_private', models.BooleanField(default=False, help_text='Si privé, nécessite une invitation', verbose_name='Privé')),
                ('is_archived', models.BooleanField(default=False, verbose_name='Archivé')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channels_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='channels', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Canal',
                'verbose_name_plural': 'Canaux',
                'db_table': 'comm_channels',
                'ordering': ['channel_type', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ChannelMembership',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('role', models.CharField(choices=[('member', 'Membre'), ('moderator', 'Modérateur'), ('admin', 'Administrateur')], default='member', max_length=20, verbose_name='Rôle')),
                ('is_muted', models.BooleanField(default=False, verbose_name='Notifications désactivées')),
                ('last_read_at', models.DateTimeField(blank=True, null=True, verbose_name='Dernière lecture')),
                ('joined_at', models.DateTimeField(auto_now_add=True)),
                ('channel', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='memberships', to='gestion_communication.channel', verbose_name='Canal')),
                ('utilisateur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='channel_memberships', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Adhésion au canal',
                'verbose_name_plural': 'Adhésions aux canaux',
                'db_table': 'comm_channel_memberships',
                'unique_together': {('channel', 'utilisateur')},
            },
        ),
        migrations.AddField(
            model_name='channel',
            name='members',
            field=models.ManyToManyField(related_name='channels_member', through='gestion_communication.ChannelMembership', to=settings.AUTH_USER_MODEL, verbose_name='Membres'),
        ),
        migrations.CreateModel(
            name='ChannelPost',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('title', models.CharField(blank=True, max_length=255, verbose_name='Titre')),
                ('content', models.TextField(verbose_name='Contenu')),
                ('is_pinned', models.BooleanField(default=False, help_text='Épingler en haut du canal', verbose_name='Épinglé')),
                ('is_announcement', models.BooleanField(default=False, verbose_name='Annonce')),
                ('attachments', models.JSONField(default=list, help_text='Liste des fichiers joints', verbose_name='Pièces jointes')),
                ('tags', models.JSONField(default=list, help_text='Tags pour catégoriser', verbose_name='Tags')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Supprimé')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='channel_posts', to=settings.AUTH_USER_MODEL, verbose_name='Auteur')),
                ('channel', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='posts', to='gestion_communication.channel', verbose_name='Canal')),
            ],
            options={
                'verbose_name': 'Publication de canal',
                'verbose_name_plural': 'Publications de canaux',
                'db_table': 'comm_channel_posts',
                'ordering': ['-is_pinned', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ChatbotConversation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('session_id', models.CharField(max_length=100, unique=True, verbose_name='ID de session')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('context', models.JSONField(default=dict, help_text='Contexte de la conversation', verbose_name='Contexte')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('pharmacie', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='chatbot_conversations', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('utilisateur', models.ForeignKey(blank=True, help_text='Null si utilisateur anonyme', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='chatbot_conversations', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Conversation chatbot',
                'verbose_name_plural': 'Conversations chatbot',
                'db_table': 'comm_chatbot_conversations',
                'ordering': ['-last_activity'],
            },
        ),
        migrations.CreateModel(
            name='ChatbotMessage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sender', models.CharField(choices=[('user', 'Utilisateur'), ('bot', 'Chatbot')], max_length=10, verbose_name='Expéditeur')),
                ('message', models.TextField(verbose_name='Message')),
                ('intent', models.CharField(blank=True, help_text="Intention détectée par l'IA", max_length=100, verbose_name='Intention')),
                ('confidence', models.DecimalField(blank=True, decimal_places=2, help_text="Confiance de l'IA (0-100%)", max_digits=5, null=True, verbose_name='Confiance')),
                ('suggested_responses', models.JSONField(default=list, help_text="Réponses suggérées par l'IA", verbose_name='Réponses suggérées')),
                ('metadata', models.JSONField(default=dict, verbose_name='Métadonnées')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('conversation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='gestion_communication.chatbotconversation', verbose_name='Conversation')),
            ],
            options={
                'verbose_name': 'Message chatbot',
                'verbose_name_plural': 'Messages chatbot',
                'db_table': 'comm_chatbot_messages',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='CommunicationArchive',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('archive_type', models.CharField(choices=[('message', 'Message'), ('consultation', 'Consultation'), ('prescription', 'Ordonnance'), ('channel_post', 'Publication de canal')], max_length=20, verbose_name='Type')),
                ('original_object_id', models.UUIDField(verbose_name="ID de l'objet original")),
                ('data', models.JSONField(help_text="Données complètes de l'objet archivé", verbose_name='Données')),
                ('participants', models.JSONField(default=list, help_text='Liste des participants (IDs et noms)', verbose_name='Participants')),
                ('archived_at', models.DateTimeField(auto_now_add=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='communication_archives', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Archive de communication',
                'verbose_name_plural': 'Archives de communications',
                'db_table': 'comm_archives',
                'ordering': ['-archived_at'],
            },
        ),
        migrations.CreateModel(
            name='Conversation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('conversation_type', models.CharField(choices=[('private', 'Privée'), ('group', 'Groupe'), ('channel', 'Canal')], default='private', max_length=20, verbose_name='Type de conversation')),
                ('name', models.CharField(blank=True, help_text='Nom du groupe ou canal (optionnel pour conversations privées)', max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('is_archived', models.BooleanField(default=False, verbose_name='Archivée')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='conversations_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('pharmacie', models.ForeignKey(blank=True, help_text='Pharmacie associée (pour les groupes/canaux)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='conversations', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Conversation',
                'verbose_name_plural': 'Conversations',
                'db_table': 'comm_conversations',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='ConversationParticipant',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('role', models.CharField(choices=[('member', 'Membre'), ('admin', 'Administrateur'), ('moderator', 'Modérateur')], default='member', max_length=20, verbose_name='Rôle')),
                ('is_muted', models.BooleanField(default=False, verbose_name='Notifications désactivées')),
                ('last_read_at', models.DateTimeField(blank=True, null=True, verbose_name='Dernière lecture')),
                ('joined_at', models.DateTimeField(auto_now_add=True)),
                ('conversation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='conversation_participants', to='gestion_communication.conversation', verbose_name='Conversation')),
                ('utilisateur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='conversation_memberships', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Participant',
                'verbose_name_plural': 'Participants',
                'db_table': 'comm_conversation_participants',
            },
        ),
        migrations.AddField(
            model_name='conversation',
            name='participants',
            field=models.ManyToManyField(related_name='conversations', through='gestion_communication.ConversationParticipant', to=settings.AUTH_USER_MODEL, verbose_name='Participants'),
        ),
        migrations.CreateModel(
            name='Message',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('message_type', models.CharField(choices=[('text', 'Texte'), ('image', 'Image'), ('file', 'Fichier'), ('prescription', 'Ordonnance'), ('system', 'Système')], default='text', max_length=20, verbose_name='Type de message')),
                ('content', models.TextField(verbose_name='Contenu')),
                ('priority', models.CharField(choices=[('low', 'Basse'), ('normal', 'Normale'), ('high', 'Haute'), ('urgent', 'Urgente')], default='normal', max_length=20, verbose_name='Priorité')),
                ('is_encrypted', models.BooleanField(default=True, verbose_name='Chiffré')),
                ('is_edited', models.BooleanField(default=False, verbose_name='Modifié')),
                ('edited_at', models.DateTimeField(blank=True, null=True, verbose_name='Modifié le')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Supprimé')),
                ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='Supprimé le')),
                ('metadata', models.JSONField(default=dict, help_text='Métadonnées supplémentaires (traduction, suggestions IA, etc.)', verbose_name='Métadonnées')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('conversation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='gestion_communication.conversation', verbose_name='Conversation')),
                ('reply_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='replies', to='gestion_communication.message', verbose_name='Réponse à')),
                ('sender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages_sent', to=settings.AUTH_USER_MODEL, verbose_name='Expéditeur')),
            ],
            options={
                'verbose_name': 'Message',
                'verbose_name_plural': 'Messages',
                'db_table': 'comm_messages',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='MessageAttachment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('attachment_type', models.CharField(choices=[('image', 'Image'), ('document', 'Document'), ('prescription', 'Ordonnance'), ('other', 'Autre')], max_length=20, verbose_name='Type de pièce jointe')),
                ('file', models.FileField(upload_to='messages/attachments/%Y/%m/%d/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png', 'doc', 'docx', 'txt'])], verbose_name='Fichier')),
                ('file_name', models.CharField(max_length=255, verbose_name='Nom du fichier')),
                ('file_size', models.IntegerField(help_text='Taille en octets', verbose_name='Taille du fichier')),
                ('mime_type', models.CharField(max_length=100, verbose_name='Type MIME')),
                ('thumbnail', models.ImageField(blank=True, null=True, upload_to='messages/thumbnails/%Y/%m/%d/', verbose_name='Miniature')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='gestion_communication.message', verbose_name='Message')),
            ],
            options={
                'verbose_name': 'Pièce jointe',
                'verbose_name_plural': 'Pièces jointes',
                'db_table': 'comm_message_attachments',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='MessageReadReceipt',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('read_at', models.DateTimeField(auto_now_add=True)),
                ('message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='read_receipts', to='gestion_communication.message', verbose_name='Message')),
                ('utilisateur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='message_reads', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Accusé de lecture',
                'verbose_name_plural': 'Accusés de lecture',
                'db_table': 'comm_message_read_receipts',
            },
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('notification_type', models.CharField(choices=[('prescription_pending', 'Ordonnance en attente'), ('prescription_ready', 'Ordonnance prête'), ('prescription_expiring', 'Ordonnance expirant bientôt'), ('stock_low', 'Stock faible'), ('stock_out', 'Rupture de stock'), ('medication_reminder', 'Rappel de prise de médicament'), ('leave_request', 'Demande de congé'), ('message', 'Nouveau message'), ('drug_interaction', 'Interaction médicamenteuse'), ('appointment', 'Rendez-vous'), ('system', 'Système'), ('other', 'Autre')], max_length=30, verbose_name='Type de notification')),
                ('priority', models.CharField(choices=[('low', 'Basse'), ('normal', 'Normale'), ('high', 'Haute'), ('urgent', 'Urgente')], default='normal', max_length=20, verbose_name='Priorité')),
                ('title', models.CharField(max_length=255, verbose_name='Titre')),
                ('message', models.TextField(verbose_name='Message')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('sent', 'Envoyée'), ('delivered', 'Délivrée'), ('read', 'Lue'), ('failed', 'Échec')], default='pending', max_length=20, verbose_name='Statut')),
                ('is_read', models.BooleanField(default=False, verbose_name='Lue')),
                ('read_at', models.DateTimeField(blank=True, null=True, verbose_name='Lue le')),
                ('send_in_app', models.BooleanField(default=True, verbose_name="Envoyer dans l'application")),
                ('send_email', models.BooleanField(default=False, verbose_name='Envoyer par email')),
                ('send_sms', models.BooleanField(default=False, verbose_name='Envoyer par SMS')),
                ('data', models.JSONField(default=dict, help_text='Données supplémentaires (liens, actions, etc.)', verbose_name='Données')),
                ('related_object_type', models.CharField(blank=True, help_text="Type d'objet lié (ex: prescription, message)", max_length=50, verbose_name="Type d'objet lié")),
                ('related_object_id', models.UUIDField(blank=True, null=True, verbose_name="ID de l'objet lié")),
                ('scheduled_for', models.DateTimeField(blank=True, help_text='Pour les notifications programmées', null=True, verbose_name='Programmée pour')),
                ('sent_at', models.DateTimeField(blank=True, null=True, verbose_name='Envoyée le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications_received', to=settings.AUTH_USER_MODEL, verbose_name='Destinataire')),
            ],
            options={
                'verbose_name': 'Notification',
                'verbose_name_plural': 'Notifications',
                'db_table': 'comm_notifications',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='NotificationPreference',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('enable_in_app', models.BooleanField(default=True, verbose_name="Notifications dans l'app")),
                ('enable_email', models.BooleanField(default=True, verbose_name='Notifications par email')),
                ('enable_sms', models.BooleanField(default=False, verbose_name='Notifications par SMS')),
                ('preferences', models.JSONField(default=dict, help_text='Préférences détaillées par type de notification', verbose_name='Préférences détaillées')),
                ('quiet_hours_start', models.TimeField(blank=True, help_text='Début de la période sans notification', null=True, verbose_name='Début période silencieuse')),
                ('quiet_hours_end', models.TimeField(blank=True, help_text='Fin de la période sans notification', null=True, verbose_name='Fin période silencieuse')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('utilisateur', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='notification_preferences', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Préférence de notification',
                'verbose_name_plural': 'Préférences de notifications',
                'db_table': 'comm_notification_preferences',
            },
        ),
        migrations.CreateModel(
            name='OnlineConsultation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('access_code', models.CharField(help_text='Code sécurisé fourni au patient', max_length=20, unique=True, verbose_name="Code d'accès")),
                ('subject', models.CharField(max_length=255, verbose_name='Sujet')),
                ('question', models.TextField(verbose_name='Question')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('in_progress', 'En cours'), ('answered', 'Répondue'), ('closed', 'Clôturée'), ('cancelled', 'Annulée')], default='pending', max_length=20, verbose_name='Statut')),
                ('response', models.TextField(blank=True, verbose_name='Réponse')),
                ('responded_at', models.DateTimeField(blank=True, null=True, verbose_name='Répondu le')),
                ('attachments', models.JSONField(default=list, help_text="Photos d'ordonnances, documents, etc.", verbose_name='Pièces jointes')),
                ('is_urgent', models.BooleanField(default=False, verbose_name='Urgent')),
                ('rating', models.IntegerField(blank=True, help_text='Note de satisfaction (1-5)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MinValueValidator(5)], verbose_name='Note')),
                ('feedback', models.TextField(blank=True, verbose_name='Commentaire')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='consultations_assigned', to=settings.AUTH_USER_MODEL, verbose_name='Assigné à')),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='consultations_requested', to=settings.AUTH_USER_MODEL, verbose_name='Patient')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='consultations', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Consultation en ligne',
                'verbose_name_plural': 'Consultations en ligne',
                'db_table': 'comm_online_consultations',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PatientMedicalRecord',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('medical_record_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de dossier médical')),
                ('blood_type', models.CharField(blank=True, choices=[('A+', 'A+'), ('A-', 'A-'), ('B+', 'B+'), ('B-', 'B-'), ('AB+', 'AB+'), ('AB-', 'AB-'), ('O+', 'O+'), ('O-', 'O-')], max_length=3, verbose_name='Groupe sanguin')),
                ('allergies', models.JSONField(default=list, help_text='Liste des allergies connues', verbose_name='Allergies')),
                ('chronic_conditions', models.JSONField(default=list, help_text='Liste des pathologies chroniques', verbose_name='Pathologies chroniques')),
                ('current_medications', models.JSONField(default=list, help_text='Médicaments actuels', verbose_name='Médicaments actuels')),
                ('emergency_contact', models.JSONField(default=dict, help_text="Contact d'urgence {nom, téléphone, relation}", verbose_name="Contact d'urgence")),
                ('notes', models.TextField(blank=True, verbose_name='Notes médicales')),
                ('is_active', models.BooleanField(default=True, verbose_name='Actif')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('patient', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='medical_record', to=settings.AUTH_USER_MODEL, verbose_name='Patient')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='patient_records', to='gestion_compte.pharmacie', verbose_name='Pharmacie principale')),
            ],
            options={
                'verbose_name': 'Dossier médical',
                'verbose_name_plural': 'Dossiers médicaux',
                'db_table': 'comm_patient_medical_records',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DrugInteractionAlert',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('medication_a', models.CharField(max_length=255, verbose_name='Médicament A')),
                ('medication_b', models.CharField(max_length=255, verbose_name='Médicament B')),
                ('severity', models.CharField(choices=[('minor', 'Mineure'), ('moderate', 'Modérée'), ('major', 'Majeure'), ('contraindicated', 'Contre-indiqué')], max_length=20, verbose_name='Sévérité')),
                ('description', models.TextField(verbose_name="Description de l'interaction")),
                ('recommendations', models.TextField(verbose_name='Recommandations')),
                ('is_acknowledged', models.BooleanField(default=False, verbose_name='Pris en compte')),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True, verbose_name='Pris en compte le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('acknowledged_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='drug_alerts_acknowledged', to=settings.AUTH_USER_MODEL, verbose_name='Pris en compte par')),
                ('medical_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='drug_interaction_alerts', to='gestion_communication.patientmedicalrecord', verbose_name='Dossier médical')),
            ],
            options={
                'verbose_name': "Alerte d'interaction médicamenteuse",
                'verbose_name_plural': "Alertes d'interactions médicamenteuses",
                'db_table': 'comm_drug_interaction_alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Prescription',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('prescription_number', models.CharField(max_length=50, unique=True, verbose_name="Numéro d'ordonnance")),
                ('prescriber_name', models.CharField(max_length=255, verbose_name='Nom du prescripteur')),
                ('prescriber_license', models.CharField(max_length=100, verbose_name='Numéro de licence du prescripteur')),
                ('prescription_date', models.DateField(verbose_name='Date de prescription')),
                ('expiry_date', models.DateField(verbose_name="Date d'expiration")),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('validated', 'Validée'), ('dispensed', 'Délivrée'), ('partially_dispensed', 'Partiellement délivrée'), ('expired', 'Expirée'), ('cancelled', 'Annulée')], default='pending', max_length=20, verbose_name='Statut')),
                ('is_renewable', models.BooleanField(default=False, verbose_name='Renouvelable')),
                ('renewal_count', models.IntegerField(default=0, verbose_name='Nombre de renouvellements')),
                ('max_renewals', models.IntegerField(default=0, verbose_name='Renouvellements maximum')),
                ('scan_document', models.FileField(blank=True, null=True, upload_to='prescriptions/%Y/%m/%d/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])], verbose_name="Scan de l'ordonnance")),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('validated_at', models.DateTimeField(blank=True, null=True, verbose_name='Validé le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('medical_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prescriptions', to='gestion_communication.patientmedicalrecord', verbose_name='Dossier médical')),
                ('validated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='validated_prescriptions', to=settings.AUTH_USER_MODEL, verbose_name='Validé par')),
            ],
            options={
                'verbose_name': 'Ordonnance',
                'verbose_name_plural': 'Ordonnances',
                'db_table': 'comm_prescriptions',
                'ordering': ['-prescription_date'],
            },
        ),
        migrations.CreateModel(
            name='MedicationHistory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('medication_name', models.CharField(max_length=255, verbose_name='Nom du médicament')),
                ('dosage', models.CharField(max_length=100, verbose_name='Dosage')),
                ('quantity', models.IntegerField(verbose_name='Quantité')),
                ('dispensed_at', models.DateTimeField(auto_now_add=True, verbose_name='Délivré le')),
                ('price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Prix')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('dispensed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='medications_dispensed', to=settings.AUTH_USER_MODEL, verbose_name='Délivré par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='medication_history', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('medical_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='medication_history', to='gestion_communication.patientmedicalrecord', verbose_name='Dossier médical')),
                ('prescription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='dispensing_history', to='gestion_communication.prescription', verbose_name='Ordonnance')),
            ],
            options={
                'verbose_name': 'Historique de médicament',
                'verbose_name_plural': 'Historiques de médicaments',
                'db_table': 'comm_medication_history',
                'ordering': ['-dispensed_at'],
            },
        ),
        migrations.CreateModel(
            name='PrescriptionItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('medication_name', models.CharField(max_length=255, verbose_name='Nom du médicament')),
                ('dosage', models.CharField(max_length=100, verbose_name='Dosage')),
                ('form', models.CharField(help_text='Forme galénique (comprimé, sirop, etc.)', max_length=100, verbose_name='Forme')),
                ('quantity', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)], verbose_name='Quantité')),
                ('frequency', models.CharField(help_text='Fréquence de prise (ex: 3 fois par jour)', max_length=255, verbose_name='Fréquence')),
                ('duration_days', models.IntegerField(help_text='Durée du traitement en jours', validators=[django.core.validators.MinValueValidator(1)], verbose_name='Durée (jours)')),
                ('instructions', models.TextField(blank=True, verbose_name='Instructions particulières')),
                ('quantity_dispensed', models.IntegerField(default=0, verbose_name='Quantité délivrée')),
                ('is_substitutable', models.BooleanField(default=True, verbose_name='Substituable')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('prescription', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='gestion_communication.prescription', verbose_name='Ordonnance')),
            ],
            options={
                'verbose_name': "Ligne d'ordonnance",
                'verbose_name_plural': "Lignes d'ordonnances",
                'db_table': 'comm_prescription_items',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserPresence',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('online', 'En ligne'), ('away', 'Absent'), ('busy', 'Occupé'), ('offline', 'Hors ligne')], default='offline', max_length=20, verbose_name='Statut')),
                ('custom_message', models.CharField(blank=True, help_text='Message de statut personnalisé', max_length=255, verbose_name='Message personnalisé')),
                ('last_seen', models.DateTimeField(auto_now=True, verbose_name='Dernière activité')),
                ('utilisateur', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='presence', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': 'Présence utilisateur',
                'verbose_name_plural': 'Présences utilisateurs',
                'db_table': 'comm_user_presence',
            },
        ),
        migrations.CreateModel(
            name='AccessLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('action', models.CharField(choices=[('view', 'Consultation'), ('create', 'Création'), ('update', 'Modification'), ('delete', 'Suppression'), ('export', 'Export'), ('share', 'Partage')], max_length=20, verbose_name='Action')),
                ('resource_type', models.CharField(help_text='Type de ressource (message, prescription, etc.)', max_length=50, verbose_name='Type de ressource')),
                ('resource_id', models.UUIDField(verbose_name='ID de la ressource')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='Adresse IP')),
                ('user_agent', models.TextField(blank=True, verbose_name='User agent')),
                ('details', models.JSONField(default=dict, help_text='Détails supplémentaires', verbose_name='Détails')),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('utilisateur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='access_logs', to=settings.AUTH_USER_MODEL, verbose_name='Utilisateur')),
            ],
            options={
                'verbose_name': "Journal d'accès",
                'verbose_name_plural': "Journaux d'accès",
                'db_table': 'comm_access_logs',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['utilisateur', '-timestamp'], name='comm_access_utilisa_e1385b_idx'), models.Index(fields=['resource_type', 'resource_id'], name='comm_access_resourc_8554d0_idx'), models.Index(fields=['action', '-timestamp'], name='comm_access_action_2a14df_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='channel',
            index=models.Index(fields=['pharmacie', 'is_archived'], name='comm_channe_pharmac_276b04_idx'),
        ),
        migrations.AddIndex(
            model_name='channel',
            index=models.Index(fields=['channel_type'], name='comm_channe_channel_55e307_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='channel',
            unique_together={('pharmacie', 'name')},
        ),
        migrations.AddIndex(
            model_name='channelpost',
            index=models.Index(fields=['channel', '-created_at'], name='comm_channe_channel_c68167_idx'),
        ),
        migrations.AddIndex(
            model_name='channelpost',
            index=models.Index(fields=['author', '-created_at'], name='comm_channe_author__a244f8_idx'),
        ),
        migrations.AddIndex(
            model_name='channelpost',
            index=models.Index(fields=['is_pinned', '-created_at'], name='comm_channe_is_pinn_25a7f8_idx'),
        ),
        migrations.AddIndex(
            model_name='chatbotconversation',
            index=models.Index(fields=['utilisateur', '-last_activity'], name='comm_chatbo_utilisa_4999cd_idx'),
        ),
        migrations.AddIndex(
            model_name='chatbotconversation',
            index=models.Index(fields=['session_id'], name='comm_chatbo_session_057a1d_idx'),
        ),
        migrations.AddIndex(
            model_name='chatbotmessage',
            index=models.Index(fields=['conversation', 'created_at'], name='comm_chatbo_convers_47c38a_idx'),
        ),
        migrations.AddIndex(
            model_name='communicationarchive',
            index=models.Index(fields=['pharmacie', '-archived_at'], name='comm_archiv_pharmac_bd79c8_idx'),
        ),
        migrations.AddIndex(
            model_name='communicationarchive',
            index=models.Index(fields=['archive_type', '-archived_at'], name='comm_archiv_archive_043ceb_idx'),
        ),
        migrations.AddIndex(
            model_name='communicationarchive',
            index=models.Index(fields=['original_object_id'], name='comm_archiv_origina_39faa7_idx'),
        ),
        migrations.AddIndex(
            model_name='conversationparticipant',
            index=models.Index(fields=['utilisateur', '-joined_at'], name='comm_conver_utilisa_3a8b31_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='conversationparticipant',
            unique_together={('conversation', 'utilisateur')},
        ),
        migrations.AddIndex(
            model_name='conversation',
            index=models.Index(fields=['conversation_type', 'is_active'], name='comm_conver_convers_7a09d0_idx'),
        ),
        migrations.AddIndex(
            model_name='conversation',
            index=models.Index(fields=['pharmacie', '-updated_at'], name='comm_conver_pharmac_615b93_idx'),
        ),
        migrations.AddIndex(
            model_name='message',
            index=models.Index(fields=['conversation', 'created_at'], name='comm_messag_convers_472f5b_idx'),
        ),
        migrations.AddIndex(
            model_name='message',
            index=models.Index(fields=['sender', '-created_at'], name='comm_messag_sender__d9335b_idx'),
        ),
        migrations.AddIndex(
            model_name='message',
            index=models.Index(fields=['priority', '-created_at'], name='comm_messag_priorit_e7952b_idx'),
        ),
        migrations.AddIndex(
            model_name='messagereadreceipt',
            index=models.Index(fields=['message', 'read_at'], name='comm_messag_message_130431_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='messagereadreceipt',
            unique_together={('message', 'utilisateur')},
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['recipient', '-created_at'], name='comm_notifi_recipie_dfc557_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['recipient', 'is_read'], name='comm_notifi_recipie_4315a0_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['status', 'scheduled_for'], name='comm_notifi_status_f25b0a_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['priority', '-created_at'], name='comm_notifi_priorit_0d3c7f_idx'),
        ),
        migrations.AddIndex(
            model_name='onlineconsultation',
            index=models.Index(fields=['patient', '-created_at'], name='comm_online_patient_d93944_idx'),
        ),
        migrations.AddIndex(
            model_name='onlineconsultation',
            index=models.Index(fields=['pharmacie', 'status'], name='comm_online_pharmac_0d2262_idx'),
        ),
        migrations.AddIndex(
            model_name='onlineconsultation',
            index=models.Index(fields=['access_code'], name='comm_online_access__7ba4f4_idx'),
        ),
        migrations.AddIndex(
            model_name='onlineconsultation',
            index=models.Index(fields=['is_urgent', '-created_at'], name='comm_online_is_urge_349962_idx'),
        ),
        migrations.AddIndex(
            model_name='patientmedicalrecord',
            index=models.Index(fields=['patient'], name='comm_patien_patient_3cbf52_idx'),
        ),
        migrations.AddIndex(
            model_name='patientmedicalrecord',
            index=models.Index(fields=['medical_record_number'], name='comm_patien_medical_774078_idx'),
        ),
        migrations.AddIndex(
            model_name='patientmedicalrecord',
            index=models.Index(fields=['pharmacie', 'is_active'], name='comm_patien_pharmac_4357c3_idx'),
        ),
        migrations.AddIndex(
            model_name='druginteractionalert',
            index=models.Index(fields=['medical_record', '-created_at'], name='comm_drug_i_medical_cc537d_idx'),
        ),
        migrations.AddIndex(
            model_name='druginteractionalert',
            index=models.Index(fields=['severity', 'is_acknowledged'], name='comm_drug_i_severit_bdee0d_idx'),
        ),
        migrations.AddIndex(
            model_name='prescription',
            index=models.Index(fields=['medical_record', '-prescription_date'], name='comm_prescr_medical_34a537_idx'),
        ),
        migrations.AddIndex(
            model_name='prescription',
            index=models.Index(fields=['prescription_number'], name='comm_prescr_prescri_e1d66e_idx'),
        ),
        migrations.AddIndex(
            model_name='prescription',
            index=models.Index(fields=['status', '-prescription_date'], name='comm_prescr_status_eba8ce_idx'),
        ),
        migrations.AddIndex(
            model_name='prescription',
            index=models.Index(fields=['expiry_date'], name='comm_prescr_expiry__8143f1_idx'),
        ),
        migrations.AddIndex(
            model_name='medicationhistory',
            index=models.Index(fields=['medical_record', '-dispensed_at'], name='comm_medica_medical_1192fc_idx'),
        ),
        migrations.AddIndex(
            model_name='medicationhistory',
            index=models.Index(fields=['pharmacie', '-dispensed_at'], name='comm_medica_pharmac_cd93ae_idx'),
        ),
        migrations.AddIndex(
            model_name='medicationhistory',
            index=models.Index(fields=['medication_name'], name='comm_medica_medicat_18980b_idx'),
        ),
        migrations.AddIndex(
            model_name='userpresence',
            index=models.Index(fields=['status', 'last_seen'], name='comm_user_p_status_f5d165_idx'),
        ),
    ]
