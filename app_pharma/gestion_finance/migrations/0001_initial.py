# Generated by Django 6.0 on 2026-01-14 15:56

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('gestion_compte', '0002_profilutilisateur'),
        ('gestion_rh', '0001_initial'),
        ('gestion_vente', '0002_cashregister_cashcount_cashtransaction_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Currency',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(help_text='Code ISO 4217 (XAF, EUR, USD)', max_length=3, unique=True, verbose_name='Code')),
                ('name', models.CharField(max_length=100, verbose_name='Nom')),
                ('symbol', models.CharField(max_length=10, verbose_name='Symbole')),
                ('exchange_rate', models.DecimalField(decimal_places=6, default=Decimal('1.000000'), help_text='Taux de change par rapport à la devise de base (XAF)', max_digits=12, verbose_name='Taux de change')),
                ('is_default', models.BooleanField(default=False, verbose_name='Devise par défaut')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Devise',
                'verbose_name_plural': 'Devises',
                'db_table': 'finance_currencies',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='CreditNote',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('credit_note_number', models.CharField(max_length=50, unique=True, verbose_name="Numéro d'avoir")),
                ('issue_date', models.DateField(default=django.utils.timezone.now, verbose_name="Date d'émission")),
                ('credit_amount', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Montant du crédit')),
                ('reason', models.CharField(choices=[('return', 'Retour de produits'), ('error', 'Erreur de facturation'), ('discount', 'Remise commerciale'), ('cancellation', 'Annulation'), ('other', 'Autre')], max_length=20, verbose_name='Raison')),
                ('description', models.TextField(verbose_name='Description')),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='credit_notes/pdfs/%Y/%m/', verbose_name='Fichier PDF')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='credit_notes_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='credit_notes', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='credit_notes', to='gestion_finance.currency', verbose_name='Devise')),
            ],
            options={
                'verbose_name': 'Avoir',
                'verbose_name_plural': 'Avoirs',
                'db_table': 'finance_credit_notes',
                'ordering': ['-issue_date'],
            },
        ),
        migrations.CreateModel(
            name='CustomerCredit',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('credit_amount', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))], verbose_name='Montant du crédit')),
                ('paid_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Montant payé')),
                ('balance_due', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Solde dû')),
                ('credit_date', models.DateField(default=django.utils.timezone.now, verbose_name='Date du crédit')),
                ('due_date', models.DateField(verbose_name="Date d'échéance")),
                ('status', models.CharField(choices=[('active', 'Active'), ('partially_paid', 'Partiellement payée'), ('paid', 'Payée'), ('overdue', 'En retard'), ('written_off', 'Radiée')], default='active', max_length=20, verbose_name='Statut')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='credits', to='gestion_rh.client', verbose_name='Client')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='customer_credits', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Crédit client',
                'verbose_name_plural': 'Crédits clients',
                'db_table': 'finance_customer_credits',
                'ordering': ['-credit_date'],
            },
        ),
        migrations.CreateModel(
            name='CreditPayment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))], verbose_name='Montant')),
                ('payment_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date de paiement')),
                ('payment_method', models.CharField(choices=[('cash', 'Espèces'), ('mobile_money', 'Mobile Money'), ('card', 'Carte bancaire'), ('bank_transfer', 'Virement bancaire'), ('check', 'Chèque'), ('credit', 'Crédit'), ('other', 'Autre')], max_length=20, verbose_name='Méthode de paiement')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='credit_payments_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('credit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='credit_payments', to='gestion_finance.customercredit', verbose_name='Crédit')),
            ],
            options={
                'verbose_name': 'Paiement de crédit',
                'verbose_name_plural': 'Paiements de crédits',
                'db_table': 'finance_credit_payments',
                'ordering': ['-payment_date'],
            },
        ),
        migrations.CreateModel(
            name='ExpenseCategory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='expense_categories', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Catégorie de dépense',
                'verbose_name_plural': 'Catégories de dépenses',
                'db_table': 'finance_expense_categories',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Invoice',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('invoice_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de facture')),
                ('invoice_type', models.CharField(choices=[('counter_sale', 'Vente comptoir'), ('online_sale', 'Vente en ligne'), ('prescription', 'Ordonnance'), ('other', 'Autre')], max_length=20, verbose_name='Type de facture')),
                ('customer_name', models.CharField(blank=True, help_text='Nom du client si non enregistré', max_length=255, verbose_name='Nom du client')),
                ('customer_email', models.EmailField(blank=True, max_length=254, verbose_name='Email du client')),
                ('customer_phone', models.CharField(blank=True, max_length=20, verbose_name='Téléphone du client')),
                ('customer_address', models.TextField(blank=True, verbose_name='Adresse du client')),
                ('issue_date', models.DateField(default=django.utils.timezone.now, verbose_name="Date d'émission")),
                ('due_date', models.DateField(blank=True, null=True, verbose_name="Date d'échéance")),
                ('paid_date', models.DateField(blank=True, null=True, verbose_name='Date de paiement')),
                ('subtotal', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Sous-total')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Montant taxes')),
                ('discount_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Montant remise')),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Montant total')),
                ('paid_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Montant payé')),
                ('balance_due', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Solde dû')),
                ('exchange_rate', models.DecimalField(decimal_places=6, default=Decimal('1.000000'), max_digits=12, verbose_name='Taux de change')),
                ('total_amount_base', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Montant total en devise de base (XAF)', max_digits=12, verbose_name='Montant total (XAF)')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('issued', 'Émise'), ('paid', 'Payée'), ('partially_paid', 'Partiellement payée'), ('overdue', 'En retard'), ('cancelled', 'Annulée'), ('credited', 'Avoir émis')], default='draft', max_length=20, verbose_name='Statut')),
                ('qr_code', models.ImageField(blank=True, null=True, upload_to='invoices/qrcodes/%Y/%m/', verbose_name='QR Code')),
                ('verification_hash', models.CharField(help_text='Hash SHA-256 pour vérification', max_length=64, unique=True, verbose_name='Hash de vérification')),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='invoices/pdfs/%Y/%m/', verbose_name='Fichier PDF')),
                ('email_sent', models.BooleanField(default=False, verbose_name='Email envoyé')),
                ('email_sent_at', models.DateTimeField(blank=True, null=True, verbose_name='Email envoyé le')),
                ('sms_sent', models.BooleanField(default=False, verbose_name='SMS envoyé')),
                ('sms_sent_at', models.DateTimeField(blank=True, null=True, verbose_name='SMS envoyé le')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('internal_notes', models.TextField(blank=True, verbose_name='Notes internes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invoices_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('credit_note', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='original_invoices', to='gestion_finance.creditnote', verbose_name='Avoir')),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='invoices', to='gestion_finance.currency', verbose_name='Devise')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='invoices', to='gestion_rh.client', verbose_name='Client')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='invoices', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('sale', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invoice', to='gestion_vente.sale', verbose_name='Vente')),
            ],
            options={
                'verbose_name': 'Facture',
                'verbose_name_plural': 'Factures',
                'db_table': 'finance_invoices',
                'ordering': ['-issue_date', '-invoice_number'],
            },
        ),
        migrations.AddField(
            model_name='customercredit',
            name='invoice',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='credits', to='gestion_finance.invoice', verbose_name='Facture'),
        ),
        migrations.AddField(
            model_name='creditnote',
            name='original_invoice',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='credit_notes', to='gestion_finance.invoice', verbose_name="Facture d'origine"),
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('payment_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de paiement')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))], verbose_name='Montant')),
                ('payment_method', models.CharField(choices=[('cash', 'Espèces'), ('mobile_money', 'Mobile Money'), ('card', 'Carte bancaire'), ('bank_transfer', 'Virement bancaire'), ('check', 'Chèque'), ('credit', 'Crédit'), ('other', 'Autre')], max_length=20, verbose_name='Méthode de paiement')),
                ('mobile_money_operator', models.CharField(blank=True, help_text='Ex: Orange Money, MTN MoMo', max_length=50, verbose_name='Opérateur Mobile Money')),
                ('mobile_money_number', models.CharField(blank=True, max_length=20, verbose_name='Numéro Mobile Money')),
                ('card_last4', models.CharField(blank=True, max_length=4, verbose_name='4 derniers chiffres carte')),
                ('card_type', models.CharField(blank=True, help_text='Visa, Mastercard, etc.', max_length=20, verbose_name='Type de carte')),
                ('check_number', models.CharField(blank=True, max_length=50, verbose_name='Numéro de chèque')),
                ('bank_name', models.CharField(blank=True, max_length=100, verbose_name='Nom de la banque')),
                ('transaction_id', models.CharField(blank=True, max_length=100, verbose_name='ID de transaction')),
                ('payment_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date de paiement')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('completed', 'Complété'), ('failed', 'Échoué'), ('refunded', 'Remboursé'), ('cancelled', 'Annulé')], default='completed', max_length=20, verbose_name='Statut')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payments', to='gestion_finance.currency', verbose_name='Devise')),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payments', to='gestion_finance.invoice', verbose_name='Facture')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('processed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='finance_payments_processed', to=settings.AUTH_USER_MODEL, verbose_name='Traité par')),
                ('sale_payment', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='finance_entry', to='gestion_vente.payment')),
            ],
            options={
                'verbose_name': 'Paiement',
                'verbose_name_plural': 'Paiements',
                'db_table': 'finance_payments',
                'ordering': ['-payment_date'],
            },
        ),
        migrations.CreateModel(
            name='TaxRate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100, verbose_name='Nom')),
                ('tax_type', models.CharField(choices=[('vat', 'TVA'), ('local_tax', 'Taxe locale'), ('special_tax', 'Taxe spéciale'), ('exemption', 'Exonération')], max_length=20, verbose_name='Type de taxe')),
                ('rate', models.DecimalField(decimal_places=2, help_text='Taux en %', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Taux %')),
                ('is_default', models.BooleanField(default=False, verbose_name='Taxe par défaut')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('valid_from', models.DateField(blank=True, null=True, verbose_name='Valide à partir du')),
                ('valid_until', models.DateField(blank=True, null=True, verbose_name="Valide jusqu'au")),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tax_rates', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Taux de taxe',
                'verbose_name_plural': 'Taux de taxes',
                'db_table': 'finance_tax_rates',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='InvoiceItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('description', models.CharField(blank=True, max_length=255, verbose_name='Description')),
                ('quantity', models.DecimalField(decimal_places=3, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.001'))], verbose_name='Quantité')),
                ('unit_price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Prix unitaire')),
                ('discount_percentage', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Remise %')),
                ('line_subtotal', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Sous-total ligne')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Montant taxe')),
                ('line_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Total ligne')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='gestion_finance.invoice', verbose_name='Facture')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='invoice_items', to='gestion_vente.product', verbose_name='Produit')),
                ('tax_rate', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='invoice_items', to='gestion_finance.taxrate', verbose_name='Taux de taxe')),
            ],
            options={
                'verbose_name': 'Ligne de facture',
                'verbose_name_plural': 'Lignes de facture',
                'db_table': 'finance_invoice_items',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='TaxReport',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('report_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de rapport')),
                ('report_type', models.CharField(choices=[('vat', 'Rapport TVA'), ('income', 'Rapport de revenus'), ('expense', 'Rapport de dépenses'), ('comprehensive', 'Rapport complet')], max_length=20, verbose_name='Type de rapport')),
                ('period_start', models.DateField(verbose_name='Début de période')),
                ('period_end', models.DateField(verbose_name='Fin de période')),
                ('total_revenue', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Revenu total')),
                ('total_tax_collected', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Total taxes collectées')),
                ('total_expenses', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Dépenses totales')),
                ('net_profit', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Bénéfice net')),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='tax_reports/%Y/%m/', verbose_name='Fichier PDF')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('generated', 'Généré'), ('submitted', 'Soumis'), ('accepted', 'Accepté')], default='draft', max_length=20, verbose_name='Statut')),
                ('submitted_at', models.DateTimeField(blank=True, null=True, verbose_name='Soumis le')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tax_reports_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tax_reports', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Rapport fiscal',
                'verbose_name_plural': 'Rapports fiscaux',
                'db_table': 'finance_tax_reports',
                'ordering': ['-period_end'],
            },
        ),
        migrations.CreateModel(
            name='Expense',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('expense_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de dépense')),
                ('expense_type', models.CharField(choices=[('supplier', 'Fournisseur'), ('utility', 'Charge (eau, électricité)'), ('rent', 'Loyer'), ('salary', 'Salaire'), ('maintenance', 'Entretien'), ('marketing', 'Marketing'), ('tax', 'Taxe'), ('insurance', 'Assurance'), ('other', 'Autre')], max_length=20, verbose_name='Type de dépense')),
                ('description', models.CharField(max_length=255, verbose_name='Description')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))], verbose_name='Montant')),
                ('expense_date', models.DateField(default=django.utils.timezone.now, verbose_name='Date de la dépense')),
                ('due_date', models.DateField(blank=True, null=True, verbose_name="Date d'échéance")),
                ('paid_date', models.DateField(blank=True, null=True, verbose_name='Date de paiement')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('approved', 'Approuvée'), ('paid', 'Payée'), ('rejected', 'Rejetée')], default='pending', max_length=20, verbose_name='Statut')),
                ('payee', models.CharField(help_text='Nom du bénéficiaire', max_length=255, verbose_name='Bénéficiaire')),
                ('payment_method', models.CharField(blank=True, choices=[('cash', 'Espèces'), ('mobile_money', 'Mobile Money'), ('card', 'Carte bancaire'), ('bank_transfer', 'Virement bancaire'), ('check', 'Chèque'), ('credit', 'Crédit'), ('other', 'Autre')], max_length=20, verbose_name='Méthode de paiement')),
                ('receipt', models.FileField(blank=True, null=True, upload_to='expenses/receipts/%Y/%m/', verbose_name='Reçu')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name='Approuvé le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='expenses_approved', to=settings.AUTH_USER_MODEL, verbose_name='Approuvé par')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='expenses_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='expenses', to='gestion_finance.currency', verbose_name='Devise')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='expenses', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='expenses', to='gestion_finance.expensecategory', verbose_name='Catégorie')),
            ],
            options={
                'verbose_name': 'Dépense',
                'verbose_name_plural': 'Dépenses',
                'db_table': 'finance_expenses',
                'ordering': ['-expense_date'],
                'indexes': [models.Index(fields=['pharmacie', '-expense_date'], name='finance_exp_pharmac_f46f4a_idx'), models.Index(fields=['expense_number'], name='finance_exp_expense_07f8c3_idx'), models.Index(fields=['category', '-expense_date'], name='finance_exp_categor_f60b1f_idx'), models.Index(fields=['status', '-expense_date'], name='finance_exp_status_199de2_idx')],
            },
        ),
        migrations.CreateModel(
            name='FinancialForecast',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('forecast_type', models.CharField(choices=[('revenue', 'Recettes'), ('expense', 'Dépenses'), ('profit', 'Bénéfice'), ('cashflow', 'Trésorerie')], max_length=20, verbose_name='Type de prévision')),
                ('period', models.CharField(choices=[('daily', 'Quotidien'), ('weekly', 'Hebdomadaire'), ('monthly', 'Mensuel'), ('quarterly', 'Trimestriel'), ('yearly', 'Annuel')], max_length=20, verbose_name='Période')),
                ('forecast_date', models.DateField(verbose_name='Date de prévision')),
                ('predicted_amount', models.DecimalField(decimal_places=2, help_text='Montant prédit', max_digits=12, verbose_name='Montant prédit')),
                ('actual_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Montant réel (à remplir ultérieurement)', max_digits=12, null=True, verbose_name='Montant réel')),
                ('variance', models.DecimalField(blank=True, decimal_places=2, help_text='Écart entre prévu et réel', max_digits=12, null=True, verbose_name='Écart')),
                ('confidence_level', models.DecimalField(decimal_places=2, help_text='Niveau de confiance en %', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Niveau de confiance %')),
                ('seasonal_factor', models.DecimalField(decimal_places=2, default=Decimal('1.00'), max_digits=5, verbose_name='Facteur saisonnier')),
                ('trend_factor', models.DecimalField(decimal_places=2, default=Decimal('1.00'), max_digits=5, verbose_name='Facteur de tendance')),
                ('algorithm_used', models.CharField(blank=True, max_length=100, verbose_name='Algorithme utilisé')),
                ('data_points_used', models.IntegerField(default=0, verbose_name='Points de données utilisés')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='financial_forecasts', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Prévision financière',
                'verbose_name_plural': 'Prévisions financières',
                'db_table': 'finance_forecasts',
                'ordering': ['-forecast_date'],
                'indexes': [models.Index(fields=['pharmacie', 'forecast_type', '-forecast_date'], name='finance_for_pharmac_3b1e60_idx')],
                'unique_together': {('pharmacie', 'forecast_type', 'forecast_date', 'period')},
            },
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['pharmacie', '-issue_date'], name='finance_inv_pharmac_813937_idx'),
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['invoice_number'], name='finance_inv_invoice_dd3aad_idx'),
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['customer', '-issue_date'], name='finance_inv_custome_f5c5d3_idx'),
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['status', '-issue_date'], name='finance_inv_status_777b07_idx'),
        ),
        migrations.AddIndex(
            model_name='invoice',
            index=models.Index(fields=['verification_hash'], name='finance_inv_verific_764457_idx'),
        ),
        migrations.AddIndex(
            model_name='customercredit',
            index=models.Index(fields=['pharmacie', 'status'], name='finance_cus_pharmac_fa43c1_idx'),
        ),
        migrations.AddIndex(
            model_name='customercredit',
            index=models.Index(fields=['customer', '-credit_date'], name='finance_cus_custome_78d373_idx'),
        ),
        migrations.AddIndex(
            model_name='customercredit',
            index=models.Index(fields=['due_date'], name='finance_cus_due_dat_e65c77_idx'),
        ),
        migrations.AddIndex(
            model_name='creditnote',
            index=models.Index(fields=['pharmacie', '-issue_date'], name='finance_cre_pharmac_b63bf8_idx'),
        ),
        migrations.AddIndex(
            model_name='creditnote',
            index=models.Index(fields=['credit_note_number'], name='finance_cre_credit__4c68ea_idx'),
        ),
        migrations.AddIndex(
            model_name='creditnote',
            index=models.Index(fields=['original_invoice'], name='finance_cre_origina_b92e23_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['pharmacie', '-payment_date'], name='finance_pay_pharmac_0c7284_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['invoice', '-payment_date'], name='finance_pay_invoice_56a271_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['payment_number'], name='finance_pay_payment_2119dc_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['payment_method', 'status'], name='finance_pay_payment_0c4763_idx'),
        ),
        migrations.AddIndex(
            model_name='taxreport',
            index=models.Index(fields=['pharmacie', '-period_end'], name='finance_tax_pharmac_238965_idx'),
        ),
        migrations.AddIndex(
            model_name='taxreport',
            index=models.Index(fields=['report_number'], name='finance_tax_report__c9ffc4_idx'),
        ),
    ]
