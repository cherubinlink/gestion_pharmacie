# Generated by Django 6.0 on 2026-01-11 08:35

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('gestion_compte', '0002_profilutilisateur'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Coupon',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='Code')),
                ('discount_type', models.CharField(choices=[('percentage', 'Pourcentage'), ('fixed_amount', 'Montant fixe')], max_length=20, verbose_name='Type de remise')),
                ('discount_value', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Valeur')),
                ('min_purchase_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Montant minimum')),
                ('max_uses', models.IntegerField(blank=True, null=True, verbose_name='Utilisations max')),
                ('current_uses', models.IntegerField(default=0, verbose_name='Utilisations')),
                ('valid_from', models.DateTimeField(verbose_name='Valide du')),
                ('valid_until', models.DateTimeField(verbose_name="Valide jusqu'au")),
                ('is_active', models.BooleanField(default=True, verbose_name='Actif')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='coupons', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Coupon',
                'verbose_name_plural': 'Coupons',
                'db_table': 'sales_coupons',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='CustomerPurchasePattern',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('total_purchases', models.IntegerField(default=0, verbose_name="Nombre d'achats")),
                ('total_spent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Total dépensé')),
                ('average_basket_value', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Panier moyen')),
                ('favorite_categories', models.JSONField(default=list, help_text='Catégories préférées', verbose_name='Catégories favorites')),
                ('favorite_products', models.JSONField(default=list, help_text='Produits achetés régulièrement', verbose_name='Produits favoris')),
                ('average_purchase_frequency', models.IntegerField(default=0, help_text='Fréquence moyenne en jours', verbose_name='Fréquence moyenne (jours)')),
                ('last_purchase_date', models.DateField(blank=True, null=True, verbose_name='Dernier achat')),
                ('next_predicted_purchase', models.DateField(blank=True, help_text='Date prédite du prochain achat', null=True, verbose_name='Prochain achat prédit')),
                ('is_at_risk', models.BooleanField(default=False, help_text='Client à risque de désabonnement', verbose_name='À risque')),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchase_patterns', to=settings.AUTH_USER_MODEL, verbose_name='Client')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='customer_patterns', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': "Comportement d'achat",
                'verbose_name_plural': "Comportements d'achat",
                'db_table': 'sales_customer_patterns',
            },
        ),
        migrations.CreateModel(
            name='ElectronicPrescription',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('prescription_number', models.CharField(max_length=50, unique=True, verbose_name="Numéro d'ordonnance")),
                ('doctor_name', models.CharField(max_length=255, verbose_name='Nom du médecin')),
                ('doctor_license', models.CharField(max_length=100, verbose_name='N° de licence du médecin')),
                ('doctor_phone', models.CharField(blank=True, max_length=20, verbose_name='Téléphone du médecin')),
                ('prescription_date', models.DateField(verbose_name='Date de prescription')),
                ('expiry_date', models.DateField(verbose_name="Date d'expiration")),
                ('document', models.FileField(upload_to='prescriptions/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png'])], verbose_name='Document')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('validated', 'Validée'), ('rejected', 'Rejetée'), ('dispensed', 'Délivrée'), ('partially_dispensed', 'Partiellement délivrée'), ('archived', 'Archivée')], default='pending', max_length=20, verbose_name='Statut')),
                ('validated_at', models.DateTimeField(blank=True, null=True, verbose_name='Validé le')),
                ('validation_notes', models.TextField(blank=True, verbose_name='Notes de validation')),
                ('is_duplicate', models.BooleanField(default=False, verbose_name='Doublon détecté')),
                ('fraud_score', models.IntegerField(default=0, help_text='Score de suspicion de fraude (0-100)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Score de fraude')),
                ('fraud_flags', models.JSONField(default=list, help_text='Indicateurs de fraude détectés', verbose_name='Alertes fraude')),
                ('archived_at', models.DateTimeField(blank=True, null=True, verbose_name='Archivé le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prescriptions', to=settings.AUTH_USER_MODEL, verbose_name='Patient')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='electronic_prescriptions', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('validated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='prescriptions_validated', to=settings.AUTH_USER_MODEL, verbose_name='Validé par')),
            ],
            options={
                'verbose_name': 'Ordonnance électronique',
                'verbose_name_plural': 'Ordonnances électroniques',
                'db_table': 'sales_electronic_prescriptions',
                'ordering': ['-prescription_date'],
            },
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('payment_method', models.CharField(choices=[('cash', 'Espèces'), ('card', 'Carte bancaire'), ('mobile_money', 'Mobile Money'), ('online', 'Paiement en ligne'), ('check', 'Chèque'), ('transfer', 'Virement'), ('deferred', 'Paiement différé')], max_length=20, verbose_name='Méthode de paiement')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Montant')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('processing', 'En traitement'), ('completed', 'Complété'), ('failed', 'Échoué'), ('cancelled', 'Annulé'), ('refunded', 'Remboursé')], default='pending', max_length=20, verbose_name='Statut')),
                ('transaction_id', models.CharField(blank=True, help_text='ID de transaction (pour paiements en ligne)', max_length=255, verbose_name='ID de transaction')),
                ('reference_number', models.CharField(blank=True, max_length=255, verbose_name='Numéro de référence')),
                ('is_installment', models.BooleanField(default=False, verbose_name='Paiement fractionné')),
                ('installment_number', models.IntegerField(blank=True, help_text='Numéro de versement', null=True, verbose_name='N° versement')),
                ('total_installments', models.IntegerField(blank=True, null=True, verbose_name='Total versements')),
                ('payment_details', models.JSONField(default=dict, help_text='Détails supplémentaires du paiement', verbose_name='Détails')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('payment_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date de paiement')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('processed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payments_processed', to=settings.AUTH_USER_MODEL, verbose_name='Traité par')),
            ],
            options={
                'verbose_name': 'Paiement',
                'verbose_name_plural': 'Paiements',
                'db_table': 'sales_payments',
                'ordering': ['-payment_date'],
            },
        ),
        migrations.CreateModel(
            name='ProductCategory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('slug', models.SlugField(max_length=255, unique=True)),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('image', models.ImageField(blank=True, null=True, upload_to='categories/', verbose_name='Image')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('display_order', models.IntegerField(default=0, verbose_name="Ordre d'affichage")),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='children', to='gestion_vente.productcategory', verbose_name='Catégorie parente')),
            ],
            options={
                'verbose_name': 'Catégorie de produit',
                'verbose_name_plural': 'Catégories de produits',
                'db_table': 'sales_product_categories',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='Product',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('slug', models.SlugField(max_length=255)),
                ('sku', models.CharField(max_length=100, unique=True, verbose_name='Code SKU')),
                ('barcode', models.CharField(blank=True, max_length=100, verbose_name='Code-barres')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('active_ingredient', models.CharField(blank=True, max_length=255, verbose_name='Principe actif')),
                ('dosage', models.CharField(blank=True, max_length=100, verbose_name='Dosage')),
                ('pharmaceutical_form', models.CharField(blank=True, max_length=100, verbose_name='Forme pharmaceutique')),
                ('manufacturer', models.CharField(blank=True, max_length=255, verbose_name='Fabricant')),
                ('purchase_price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name="Prix d'achat HT")),
                ('selling_price', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Prix de vente TTC')),
                ('tax_rate', models.DecimalField(decimal_places=2, default=Decimal('19.25'), help_text='Taux de TVA en %', max_digits=5, verbose_name='Taux de TVA')),
                ('stock_quantity', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)], verbose_name='Quantité en stock')),
                ('min_stock_level', models.IntegerField(default=10, validators=[django.core.validators.MinValueValidator(0)], verbose_name='Seuil de stock minimum')),
                ('is_available_online', models.BooleanField(default=False, verbose_name='Disponible en ligne')),
                ('requires_prescription', models.BooleanField(default=False, verbose_name='Nécessite une ordonnance')),
                ('usage_instructions', models.TextField(blank=True, verbose_name="Instructions d'utilisation")),
                ('side_effects', models.TextField(blank=True, verbose_name='Effets secondaires')),
                ('contraindications', models.TextField(blank=True, verbose_name='Contre-indications')),
                ('storage_conditions', models.TextField(blank=True, verbose_name='Conditions de conservation')),
                ('main_image', models.ImageField(blank=True, null=True, upload_to='products/', verbose_name='Image principale')),
                ('images', models.JSONField(default=list, help_text='URLs des images supplémentaires', verbose_name='Images supplémentaires')),
                ('is_active', models.BooleanField(default=True, verbose_name='Actif')),
                ('is_featured', models.BooleanField(default=False, verbose_name='Produit vedette')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products_created', to=settings.AUTH_USER_MODEL, verbose_name='Créé par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='products', to='gestion_vente.productcategory', verbose_name='Catégorie')),
            ],
            options={
                'verbose_name': 'Produit',
                'verbose_name_plural': 'Produits',
                'db_table': 'sales_products',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ProductPerformance',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('period_start', models.DateField(verbose_name='Début période')),
                ('period_end', models.DateField(verbose_name='Fin période')),
                ('units_sold', models.IntegerField(default=0, verbose_name='Unités vendues')),
                ('revenue', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='CA généré')),
                ('profit', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Bénéfice')),
                ('sales_trend', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Évolution des ventes en %', max_digits=6, verbose_name='Tendance ventes %')),
                ('is_declining', models.BooleanField(default=False, verbose_name='En baisse')),
                ('restock_recommended', models.BooleanField(default=False, verbose_name='Réassort recommandé')),
                ('recommended_quantity', models.IntegerField(default=0, verbose_name='Quantité recommandée')),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_metrics', to='gestion_vente.product', verbose_name='Produit')),
            ],
            options={
                'verbose_name': 'Performance produit',
                'verbose_name_plural': 'Performances produits',
                'db_table': 'sales_product_performance',
                'ordering': ['-period_start', '-revenue'],
            },
        ),
        migrations.CreateModel(
            name='ProductRecommendation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('recommendation_type', models.CharField(choices=[('frequently_bought_together', 'Souvent achetés ensemble'), ('similar_products', 'Produits similaires'), ('complementary', 'Produits complémentaires'), ('based_on_history', "Basé sur l'historique"), ('trending', 'Tendance')], max_length=30, verbose_name='Type de recommandation')),
                ('confidence_score', models.DecimalField(decimal_places=2, help_text='Score de confiance (0-100)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Score de confiance')),
                ('times_bought_together', models.IntegerField(default=0, verbose_name='Fois achetés ensemble')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('recommended_product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recommendations_to', to='gestion_vente.product', verbose_name='Produit recommandé')),
                ('source_product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recommendations_from', to='gestion_vente.product', verbose_name='Produit source')),
            ],
            options={
                'verbose_name': 'Recommandation produit',
                'verbose_name_plural': 'Recommandations produits',
                'db_table': 'sales_product_recommendations',
                'ordering': ['-confidence_score'],
            },
        ),
        migrations.CreateModel(
            name='Promotion',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, verbose_name='Nom')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('promotion_code', models.CharField(blank=True, help_text='Code promo (optionnel)', max_length=50, verbose_name='Code promo')),
                ('discount_type', models.CharField(choices=[('percentage', 'Pourcentage'), ('fixed_amount', 'Montant fixe'), ('buy_x_get_y', 'Achetez X obtenez Y'), ('bundle', 'Lot/Bundle')], max_length=20, verbose_name='Type de remise')),
                ('discount_value', models.DecimalField(decimal_places=2, help_text='Pourcentage ou montant', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Valeur de la remise')),
                ('promotion_scope', models.CharField(choices=[('product', 'Produit spécifique'), ('category', 'Catégorie'), ('all_products', 'Tous les produits'), ('loyal_customers', 'Clients fidèles')], max_length=20, verbose_name='Portée de la promotion')),
                ('min_purchase_amount', models.DecimalField(blank=True, decimal_places=2, help_text="Montant minimum d'achat", max_digits=10, null=True, verbose_name='Montant minimum')),
                ('min_quantity', models.IntegerField(blank=True, help_text='Quantité minimum', null=True, verbose_name='Quantité minimum')),
                ('max_uses', models.IntegerField(blank=True, help_text="Nombre maximum d'utilisations", null=True, verbose_name='Utilisations maximum')),
                ('max_uses_per_customer', models.IntegerField(blank=True, help_text='Utilisations max par client', null=True, verbose_name='Max par client')),
                ('current_uses', models.IntegerField(default=0, verbose_name='Utilisations actuelles')),
                ('start_date', models.DateTimeField(verbose_name='Date de début')),
                ('end_date', models.DateTimeField(verbose_name='Date de fin')),
                ('happy_hours_start', models.TimeField(blank=True, help_text='Début des happy hours', null=True, verbose_name='Début happy hours')),
                ('happy_hours_end', models.TimeField(blank=True, help_text='Fin des happy hours', null=True, verbose_name='Fin happy hours')),
                ('is_active', models.BooleanField(default=True, verbose_name='Active')),
                ('is_stackable', models.BooleanField(default=False, help_text="Peut être cumulée avec d'autres promos", verbose_name='Cumulable')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('applicable_categories', models.ManyToManyField(blank=True, related_name='promotions', to='gestion_vente.productcategory', verbose_name='Catégories concernées')),
                ('applicable_products', models.ManyToManyField(blank=True, related_name='promotions', to='gestion_vente.product', verbose_name='Produits concernés')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='promotions', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Promotion',
                'verbose_name_plural': 'Promotions',
                'db_table': 'sales_promotions',
                'ordering': ['-start_date'],
            },
        ),
        migrations.CreateModel(
            name='Sale',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sale_number', models.CharField(max_length=50, unique=True, verbose_name='Numéro de vente')),
                ('sale_type', models.CharField(choices=[('counter', 'Vente comptoir'), ('online', 'Commande en ligne'), ('phone', 'Commande téléphonique'), ('prescription', 'Sur ordonnance')], default='counter', max_length=20, verbose_name='Type de vente')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('pending', 'En attente'), ('confirmed', 'Confirmée'), ('processing', 'En traitement'), ('completed', 'Terminée'), ('cancelled', 'Annulée'), ('refunded', 'Remboursée')], default='pending', max_length=20, verbose_name='Statut')),
                ('customer_name', models.CharField(blank=True, help_text='Nom du client si non enregistré', max_length=255, verbose_name='Nom du client')),
                ('customer_phone', models.CharField(blank=True, max_length=20, verbose_name='Téléphone du client')),
                ('customer_email', models.EmailField(blank=True, max_length=254, verbose_name='Email du client')),
                ('subtotal', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Sous-total')),
                ('discount_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Montant remise')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Montant TVA')),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Montant total')),
                ('profit_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Bénéfice')),
                ('ticket_qr_code', models.ImageField(blank=True, null=True, upload_to='tickets/qr/', verbose_name='QR Code du ticket')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('internal_notes', models.TextField(blank=True, verbose_name='Notes internes')),
                ('is_offline_sale', models.BooleanField(default=False, verbose_name='Vente hors ligne')),
                ('synced_at', models.DateTimeField(blank=True, null=True, verbose_name='Synchronisée le')),
                ('sale_date', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date de vente')),
                ('completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Terminée le')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('applied_coupon', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sales', to='gestion_vente.coupon', verbose_name='Coupon appliqué')),
                ('applied_promotions', models.ManyToManyField(blank=True, related_name='sales', to='gestion_vente.promotion', verbose_name='Promotions appliquées')),
                ('cashier', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sales_made', to=settings.AUTH_USER_MODEL, verbose_name='Caissier')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='purchases', to=settings.AUTH_USER_MODEL, verbose_name='Client')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('prescription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sales', to='gestion_vente.electronicprescription', verbose_name='Ordonnance')),
            ],
            options={
                'verbose_name': 'Vente',
                'verbose_name_plural': 'Ventes',
                'db_table': 'sales_sales',
                'ordering': ['-sale_date'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseAnomalyLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('anomaly_type', models.CharField(max_length=100, verbose_name="Type d'anomalie")),
                ('description', models.TextField(verbose_name='Description')),
                ('anomaly_score', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name="Score d'anomalie")),
                ('details', models.JSONField(default=dict, verbose_name='Détails')),
                ('auto_flagged', models.BooleanField(default=True, help_text='Détecté automatiquement', verbose_name='Auto-détecté')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='purchase_anomalies', to=settings.AUTH_USER_MODEL, verbose_name='Client')),
                ('sale', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='anomaly_logs', to='gestion_vente.sale', verbose_name='Vente')),
            ],
            options={
                'verbose_name': "Anomalie d'achat",
                'verbose_name_plural': "Anomalies d'achat",
                'db_table': 'sales_purchase_anomaly_logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PaymentInstallment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('installment_number', models.IntegerField(verbose_name='N° versement')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))], verbose_name='Montant')),
                ('due_date', models.DateField(verbose_name="Date d'échéance")),
                ('is_paid', models.BooleanField(default=False, verbose_name='Payé')),
                ('paid_date', models.DateField(blank=True, null=True, verbose_name='Date de paiement')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('payment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='installments', to='gestion_vente.payment', verbose_name='Paiement')),
                ('sale', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_plan', to='gestion_vente.sale', verbose_name='Vente')),
            ],
            options={
                'verbose_name': 'Versement',
                'verbose_name_plural': 'Versements',
                'db_table': 'sales_payment_installments',
                'ordering': ['installment_number'],
            },
        ),
        migrations.AddField(
            model_name='payment',
            name='sale',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='gestion_vente.sale', verbose_name='Vente'),
        ),
        migrations.CreateModel(
            name='FraudAlert',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('alert_type', models.CharField(choices=[('duplicate_prescription', 'Ordonnance en double'), ('unusual_purchase_pattern', "Pattern d'achat inhabituel"), ('excessive_quantity', 'Quantité excessive'), ('rapid_repeat_purchase', 'Rachat rapide'), ('suspicious_prescription', 'Ordonnance suspecte'), ('resale_indicator', 'Indicateur de revente'), ('multiple_pharmacies', 'Achats dans plusieurs pharmacies')], max_length=30, verbose_name="Type d'alerte")),
                ('severity', models.CharField(choices=[('low', 'Faible'), ('medium', 'Moyenne'), ('high', 'Élevée'), ('critical', 'Critique')], max_length=20, verbose_name='Sévérité')),
                ('status', models.CharField(choices=[('new', 'Nouvelle'), ('investigating', 'En investigation'), ('confirmed', 'Confirmée'), ('false_positive', 'Fausse alerte'), ('resolved', 'Résolue')], default='new', max_length=20, verbose_name='Statut')),
                ('description', models.TextField(verbose_name='Description')),
                ('indicators', models.JSONField(default=list, help_text='Indicateurs détectés', verbose_name='Indicateurs')),
                ('risk_score', models.IntegerField(help_text='Score de risque (0-100)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Score de risque')),
                ('investigation_notes', models.TextField(blank=True, verbose_name="Notes d'investigation")),
                ('resolution_notes', models.TextField(blank=True, verbose_name='Notes de résolution')),
                ('actions_taken', models.JSONField(default=list, help_text='Actions entreprises', verbose_name='Actions prises')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True, verbose_name='Résolue le')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='fraud_alerts', to=settings.AUTH_USER_MODEL, verbose_name='Client')),
                ('investigated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fraud_investigations', to=settings.AUTH_USER_MODEL, verbose_name='Investigué par')),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fraud_alerts', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
                ('prescription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='fraud_alerts', to='gestion_vente.electronicprescription', verbose_name='Ordonnance')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='fraud_alerts', to='gestion_vente.product', verbose_name='Produit')),
                ('sale', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='fraud_alerts', to='gestion_vente.sale', verbose_name='Vente')),
            ],
            options={
                'verbose_name': 'Alerte de fraude',
                'verbose_name_plural': 'Alertes de fraude',
                'db_table': 'sales_fraud_alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SaleItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('quantity', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)], verbose_name='Quantité')),
                ('unit_price', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Prix unitaire')),
                ('unit_cost', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Coût unitaire')),
                ('discount_percentage', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Remise %')),
                ('discount_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Montant remise')),
                ('line_subtotal', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Sous-total ligne')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='TVA')),
                ('line_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Total ligne')),
                ('profit_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Bénéfice')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('applied_promotion', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion_vente.promotion', verbose_name='Promotion appliquée')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='sale_items', to='gestion_vente.product', verbose_name='Produit')),
                ('sale', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='gestion_vente.sale', verbose_name='Vente')),
            ],
            options={
                'verbose_name': 'Ligne de vente',
                'verbose_name_plural': 'Lignes de vente',
                'db_table': 'sales_sale_items',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='SalesAnalytics',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('period_type', models.CharField(choices=[('daily', 'Quotidien'), ('weekly', 'Hebdomadaire'), ('monthly', 'Mensuel'), ('quarterly', 'Trimestriel'), ('yearly', 'Annuel')], max_length=20, verbose_name='Type de période')),
                ('period_start', models.DateField(verbose_name='Début période')),
                ('period_end', models.DateField(verbose_name='Fin période')),
                ('total_sales_count', models.IntegerField(default=0, verbose_name='Nombre de ventes')),
                ('total_revenue', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name="Chiffre d'affaires")),
                ('total_profit', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12, verbose_name='Bénéfice total')),
                ('average_basket', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Panier moyen')),
                ('total_items_sold', models.IntegerField(default=0, verbose_name='Articles vendus')),
                ('unique_products_sold', models.IntegerField(default=0, verbose_name='Produits uniques vendus')),
                ('total_customers', models.IntegerField(default=0, verbose_name='Nombre de clients')),
                ('new_customers', models.IntegerField(default=0, verbose_name='Nouveaux clients')),
                ('returning_customers', models.IntegerField(default=0, verbose_name='Clients fidèles')),
                ('best_selling_product', models.JSONField(default=dict, help_text='Produit le plus vendu {id, name, quantity}', verbose_name='Produit best-seller')),
                ('best_revenue_product', models.JSONField(default=dict, help_text='Produit générant le plus de CA', verbose_name='Produit top CA')),
                ('revenue_trend', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Évolution en % par rapport à la période précédente', max_digits=6, verbose_name='Tendance CA %')),
                ('profit_margin', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Marge bénéficiaire moyenne en %', max_digits=6, verbose_name='Marge %')),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('pharmacie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales_analytics', to='gestion_compte.pharmacie', verbose_name='Pharmacie')),
            ],
            options={
                'verbose_name': 'Analytics de vente',
                'verbose_name_plural': 'Analytics de ventes',
                'db_table': 'sales_analytics',
                'ordering': ['-period_start'],
            },
        ),
        migrations.AddIndex(
            model_name='coupon',
            index=models.Index(fields=['code'], name='sales_coupo_code_79f159_idx'),
        ),
        migrations.AddIndex(
            model_name='coupon',
            index=models.Index(fields=['pharmacie', 'is_active'], name='sales_coupo_pharmac_44f361_idx'),
        ),
        migrations.AddIndex(
            model_name='customerpurchasepattern',
            index=models.Index(fields=['customer', 'pharmacie'], name='sales_custo_custome_34784e_idx'),
        ),
        migrations.AddIndex(
            model_name='customerpurchasepattern',
            index=models.Index(fields=['is_at_risk'], name='sales_custo_is_at_r_7c12c0_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='customerpurchasepattern',
            unique_together={('customer', 'pharmacie')},
        ),
        migrations.AddIndex(
            model_name='electronicprescription',
            index=models.Index(fields=['pharmacie', '-prescription_date'], name='sales_elect_pharmac_2bd354_idx'),
        ),
        migrations.AddIndex(
            model_name='electronicprescription',
            index=models.Index(fields=['prescription_number'], name='sales_elect_prescri_4a6a65_idx'),
        ),
        migrations.AddIndex(
            model_name='electronicprescription',
            index=models.Index(fields=['patient', '-prescription_date'], name='sales_elect_patient_df8b6e_idx'),
        ),
        migrations.AddIndex(
            model_name='electronicprescription',
            index=models.Index(fields=['status', '-prescription_date'], name='sales_elect_status_a8e4ed_idx'),
        ),
        migrations.AddIndex(
            model_name='electronicprescription',
            index=models.Index(fields=['is_duplicate'], name='sales_elect_is_dupl_4e576e_idx'),
        ),
        migrations.AddIndex(
            model_name='productcategory',
            index=models.Index(fields=['slug'], name='sales_produ_slug_bfc403_idx'),
        ),
        migrations.AddIndex(
            model_name='productcategory',
            index=models.Index(fields=['is_active', 'display_order'], name='sales_produ_is_acti_b42c67_idx'),
        ),
        migrations.AddIndex(
            model_name='product',
            index=models.Index(fields=['pharmacie', 'is_active'], name='sales_produ_pharmac_e94962_idx'),
        ),
        migrations.AddIndex(
            model_name='product',
            index=models.Index(fields=['category', 'is_active'], name='sales_produ_categor_ee057c_idx'),
        ),
        migrations.AddIndex(
            model_name='product',
            index=models.Index(fields=['sku'], name='sales_produ_sku_94bb22_idx'),
        ),
        migrations.AddIndex(
            model_name='product',
            index=models.Index(fields=['barcode'], name='sales_produ_barcode_4082b0_idx'),
        ),
        migrations.AddIndex(
            model_name='product',
            index=models.Index(fields=['is_available_online', 'is_active'], name='sales_produ_is_avai_cd1beb_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='product',
            unique_together={('pharmacie', 'slug')},
        ),
        migrations.AddIndex(
            model_name='productperformance',
            index=models.Index(fields=['product', '-period_start'], name='sales_produ_product_637389_idx'),
        ),
        migrations.AddIndex(
            model_name='productperformance',
            index=models.Index(fields=['-revenue'], name='sales_produ_revenue_e96592_idx'),
        ),
        migrations.AddIndex(
            model_name='productperformance',
            index=models.Index(fields=['is_declining'], name='sales_produ_is_decl_52e9c4_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='productperformance',
            unique_together={('product', 'period_start')},
        ),
        migrations.AddIndex(
            model_name='productrecommendation',
            index=models.Index(fields=['source_product', '-confidence_score'], name='sales_produ_source__faf34b_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='productrecommendation',
            unique_together={('source_product', 'recommended_product')},
        ),
        migrations.AddIndex(
            model_name='promotion',
            index=models.Index(fields=['pharmacie', 'is_active'], name='sales_promo_pharmac_054dac_idx'),
        ),
        migrations.AddIndex(
            model_name='promotion',
            index=models.Index(fields=['promotion_code'], name='sales_promo_promoti_1e742b_idx'),
        ),
        migrations.AddIndex(
            model_name='promotion',
            index=models.Index(fields=['start_date', 'end_date'], name='sales_promo_start_d_4b8b08_idx'),
        ),
        migrations.AddIndex(
            model_name='sale',
            index=models.Index(fields=['pharmacie', '-sale_date'], name='sales_sales_pharmac_0f0d34_idx'),
        ),
        migrations.AddIndex(
            model_name='sale',
            index=models.Index(fields=['sale_number'], name='sales_sales_sale_nu_585005_idx'),
        ),
        migrations.AddIndex(
            model_name='sale',
            index=models.Index(fields=['customer', '-sale_date'], name='sales_sales_custome_2b530f_idx'),
        ),
        migrations.AddIndex(
            model_name='sale',
            index=models.Index(fields=['status', '-sale_date'], name='sales_sales_status_f50efd_idx'),
        ),
        migrations.AddIndex(
            model_name='sale',
            index=models.Index(fields=['sale_type', '-sale_date'], name='sales_sales_sale_ty_89da78_idx'),
        ),
        migrations.AddIndex(
            model_name='purchaseanomalylog',
            index=models.Index(fields=['customer', '-created_at'], name='sales_purch_custome_e260b5_idx'),
        ),
        migrations.AddIndex(
            model_name='purchaseanomalylog',
            index=models.Index(fields=['sale'], name='sales_purch_sale_id_38a32b_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='paymentinstallment',
            unique_together={('sale', 'installment_number')},
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['sale', '-payment_date'], name='sales_payme_sale_id_c11963_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['payment_method', '-payment_date'], name='sales_payme_payment_9fa7cf_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['status', '-payment_date'], name='sales_payme_status_2adf4c_idx'),
        ),
        migrations.AddIndex(
            model_name='payment',
            index=models.Index(fields=['transaction_id'], name='sales_payme_transac_7cfa59_idx'),
        ),
        migrations.AddIndex(
            model_name='fraudalert',
            index=models.Index(fields=['pharmacie', 'status', '-created_at'], name='sales_fraud_pharmac_ee4cbd_idx'),
        ),
        migrations.AddIndex(
            model_name='fraudalert',
            index=models.Index(fields=['customer', '-created_at'], name='sales_fraud_custome_e741fd_idx'),
        ),
        migrations.AddIndex(
            model_name='fraudalert',
            index=models.Index(fields=['severity', 'status'], name='sales_fraud_severit_842b3f_idx'),
        ),
        migrations.AddIndex(
            model_name='salesanalytics',
            index=models.Index(fields=['pharmacie', 'period_type', '-period_start'], name='sales_analy_pharmac_b03c5c_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='salesanalytics',
            unique_together={('pharmacie', 'period_type', 'period_start')},
        ),
    ]
